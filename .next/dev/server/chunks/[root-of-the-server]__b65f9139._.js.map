{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/sandeep/Downloads/invoiceji-backend/app/lib/db.ts"],"sourcesContent":["import mongoose from 'mongoose';\n\nconst MONGODB_URI = process.env.MONGODB_URI!;\n\nif (!MONGODB_URI) {\n  throw new Error('Please define the MONGODB_URI environment variable');\n}\n\ninterface MongooseCache {\n  conn: typeof mongoose | null;\n  promise: Promise<typeof mongoose> | null;\n}\n\ndeclare global {\n  var mongoose: MongooseCache | undefined;\n}\n\nlet cached: MongooseCache = global.mongoose || {\n  conn: null,\n  promise: null,\n};\n\nif (!global.mongoose) {\n  global.mongoose = cached;\n}\n\nasync function dbConnect(): Promise<typeof mongoose> {\n  if (cached.conn) {\n    return cached.conn;\n  }\n\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n    };\n\n    cached.promise = mongoose.connect(MONGODB_URI, opts);\n  }\n\n  try {\n    cached.conn = await cached.promise;\n  } catch (e) {\n    cached.promise = null;\n    throw e;\n  }\n\n  return cached.conn;\n}\n\nexport default dbConnect;"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MAAM;AAClB;AAWA,IAAI,SAAwB,OAAO,QAAQ,IAAI;IAC7C,MAAM;IACN,SAAS;AACX;AAEA,IAAI,CAAC,OAAO,QAAQ,EAAE;IACpB,OAAO,QAAQ,GAAG;AACpB;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa;IACjD;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe","debugId":null}},
    {"offset": {"line": 92, "column": 0}, "map": {"version":3,"sources":["file:///Users/sandeep/Downloads/invoiceji-backend/models/User.ts"],"sourcesContent":["import mongoose, { Document, Schema } from 'mongoose';\nimport bcrypt from 'bcryptjs';\n\nexport interface IUser extends Document {\n  name: string;\n  email: string;\n  password: string;\n  business_name: string;\n  plan: 'free' | 'premium';\n  template_id: string | null;\n  is_premium: boolean;\n  subscription?: {\n    plan_name: string;\n    start_date: Date;\n    end_date: Date;\n    active: boolean;\n  };\n  created_at: Date;\n  last_login: Date;\n  comparePassword(candidatePassword: string): Promise<boolean>;\n}\n\nconst userSchema = new Schema<IUser>({\n  name: {\n    type: String,\n    required: [true, 'Name is required'],\n    trim: true,\n  },\n  email: {\n    type: String,\n    required: [true, 'Email is required'],\n    unique: true,\n    lowercase: true,\n    trim: true,\n  },\n  password: {\n    type: String,\n    required: [true, 'Password is required'],\n    minlength: 6,\n  },\n  business_name: {\n    type: String,\n    required: [true, 'Business name is required'],\n    trim: true,\n  },\n  plan: {\n    type: String,\n    enum: ['free', 'premium'],\n    default: 'free',\n  },\n  template_id: {\n    type: String,\n    default: null,\n  },\n  is_premium: {\n    type: Boolean,\n    default: false,\n  },\n  subscription: {\n    plan_name: String,\n    start_date: Date,\n    end_date: Date,\n    active: Boolean,\n  },\n  created_at: {\n    type: Date,\n    default: Date.now,\n  },\n  last_login: {\n    type: Date,\n    default: Date.now,\n  },\n});\n\n// Hash password before saving\nuserSchema.pre('save', async function (next) {\n  if (!this.isModified('password')) return next();\n  \n  try {\n    const salt = await bcrypt.genSalt(12);\n    this.password = await bcrypt.hash(this.password, salt);\n    next();\n  } catch (error: any) {\n    next(error);\n  }\n});\n\n// Compare password method\nuserSchema.methods.comparePassword = async function (candidatePassword: string): Promise<boolean> {\n  return bcrypt.compare(candidatePassword, this.password);\n};\n\nexport default mongoose.models.User || mongoose.model<IUser>('User', userSchema);"],"names":[],"mappings":";;;;AAAA;AACA;;;AAqBA,MAAM,aAAa,IAAI,mHAAM,CAAQ;IACnC,MAAM;QACJ,MAAM;QACN,UAAU;YAAC;YAAM;SAAmB;QACpC,MAAM;IACR;IACA,OAAO;QACL,MAAM;QACN,UAAU;YAAC;YAAM;SAAoB;QACrC,QAAQ;QACR,WAAW;QACX,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,UAAU;YAAC;YAAM;SAAuB;QACxC,WAAW;IACb;IACA,eAAe;QACb,MAAM;QACN,UAAU;YAAC;YAAM;SAA4B;QAC7C,MAAM;IACR;IACA,MAAM;QACJ,MAAM;QACN,MAAM;YAAC;YAAQ;SAAU;QACzB,SAAS;IACX;IACA,aAAa;QACX,MAAM;QACN,SAAS;IACX;IACA,YAAY;QACV,MAAM;QACN,SAAS;IACX;IACA,cAAc;QACZ,WAAW;QACX,YAAY;QACZ,UAAU;QACV,QAAQ;IACV;IACA,YAAY;QACV,MAAM;QACN,SAAS,KAAK,GAAG;IACnB;IACA,YAAY;QACV,MAAM;QACN,SAAS,KAAK,GAAG;IACnB;AACF;AAEA,8BAA8B;AAC9B,WAAW,GAAG,CAAC,QAAQ,eAAgB,IAAI;IACzC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa,OAAO;IAEzC,IAAI;QACF,MAAM,OAAO,MAAM,8IAAM,CAAC,OAAO,CAAC;QAClC,IAAI,CAAC,QAAQ,GAAG,MAAM,8IAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;QACjD;IACF,EAAE,OAAO,OAAY;QACnB,KAAK;IACP;AACF;AAEA,0BAA0B;AAC1B,WAAW,OAAO,CAAC,eAAe,GAAG,eAAgB,iBAAyB;IAC5E,OAAO,8IAAM,CAAC,OAAO,CAAC,mBAAmB,IAAI,CAAC,QAAQ;AACxD;uCAEe,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ","debugId":null}},
    {"offset": {"line": 204, "column": 0}, "map": {"version":3,"sources":["file:///Users/sandeep/Downloads/invoiceji-backend/app/lib/auth.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\nimport { IUser } from '@/models/User';\n\nconst JWT_SECRET = process.env.JWT_SECRET!;\nconst JWT_EXPIRES_IN = process.env.JWT_EXPIRES_IN || '1h';\n\nexport function generateToken(user: IUser): string {\n  return jwt.sign(\n    { \n      userId: user._id,\n      email: user.email,\n      plan: user.plan \n    },\n    JWT_SECRET,\n    { expiresIn: JWT_EXPIRES_IN }\n  );\n}\n\nexport function verifyToken(token: string): any {\n  try {\n    return jwt.verify(token, JWT_SECRET);\n  } catch (error) {\n    throw new Error('Invalid or expired token');\n  }\n}\n\nexport function authenticateToken(authHeader: string | null) {\n  if (!authHeader || !authHeader.startsWith('Bearer ')) {\n    throw new Error('Access token required');\n  }\n\n  const token = authHeader.substring(7);\n  return verifyToken(token);\n}"],"names":[],"mappings":";;;;;;;;AAAA;;AAGA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU;AACzC,MAAM,iBAAiB,QAAQ,GAAG,CAAC,cAAc,IAAI;AAE9C,SAAS,cAAc,IAAW;IACvC,OAAO,kJAAG,CAAC,IAAI,CACb;QACE,QAAQ,KAAK,GAAG;QAChB,OAAO,KAAK,KAAK;QACjB,MAAM,KAAK,IAAI;IACjB,GACA,YACA;QAAE,WAAW;IAAe;AAEhC;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,OAAO;QACd,MAAM,IAAI,MAAM;IAClB;AACF;AAEO,SAAS,kBAAkB,UAAyB;IACzD,IAAI,CAAC,cAAc,CAAC,WAAW,UAAU,CAAC,YAAY;QACpD,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,QAAQ,WAAW,SAAS,CAAC;IACnC,OAAO,YAAY;AACrB","debugId":null}},
    {"offset": {"line": 249, "column": 0}, "map": {"version":3,"sources":["file:///Users/sandeep/Downloads/invoiceji-backend/app/lib/utils.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\n\nexport function successResponse(message: string, data?: any, status = 200) {\n  return NextResponse.json({\n    status: 'success',\n    message,\n    ...data,\n  }, { status });\n}\n\nexport function errorResponse(message: string, status = 400) {\n  return NextResponse.json({\n    status: 'error',\n    message,\n  }, { status });\n}\n\nexport function generateRandomToken(length = 32): string {\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  let result = '';\n  for (let i = 0; i < length; i++) {\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return result;\n}"],"names":[],"mappings":";;;;;;;;AAAA;;AAEO,SAAS,gBAAgB,OAAe,EAAE,IAAU,EAAE,SAAS,GAAG;IACvE,OAAO,gJAAY,CAAC,IAAI,CAAC;QACvB,QAAQ;QACR;QACA,GAAG,IAAI;IACT,GAAG;QAAE;IAAO;AACd;AAEO,SAAS,cAAc,OAAe,EAAE,SAAS,GAAG;IACzD,OAAO,gJAAY,CAAC,IAAI,CAAC;QACvB,QAAQ;QACR;IACF,GAAG;QAAE;IAAO;AACd;AAEO,SAAS,oBAAoB,SAAS,EAAE;IAC7C,MAAM,QAAQ;IACd,IAAI,SAAS;IACb,IAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,IAAK;QAC/B,UAAU,MAAM,MAAM,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,MAAM,MAAM;IAChE;IACA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 288, "column": 0}, "map": {"version":3,"sources":["file:///Users/sandeep/Downloads/invoiceji-backend/app/api/auth/register/route.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\nimport dbConnect from '@/app/lib/db';\nimport User from '@/models/User';\nimport { generateToken } from '@/app/lib/auth';\nimport { successResponse, errorResponse } from '@/app/lib/utils';\n\nexport async function POST(request: NextRequest) {\n  try {\n    await dbConnect();\n\n    const { name, email, password, business_name, plan = 'free' } = await request.json();\n\n    // Validation\n    if (!name || !email || !password || !business_name) {\n      return errorResponse('Missing required fields', 400);\n    }\n\n    if (password.length < 6) {\n      return errorResponse('Password must be at least 6 characters', 400);\n    }\n\n    // Check if user already exists\n    const existingUser = await User.findOne({ email });\n    if (existingUser) {\n      return errorResponse('Email already registered', 409);\n    }\n\n    // Create user\n    const user = await User.create({\n      name,\n      email,\n      password,\n      business_name,\n      plan,\n      is_premium: plan === 'premium',\n      template_id: plan === 'premium' ? 'TEMPLATE_01' : null,\n    });\n\n    // Generate token\n    const access_token = generateToken(user);\n\n    const userResponse = {\n      id: user._id.toString(),\n      name: user.name,\n      email: user.email,\n      business_name: user.business_name,\n      plan: user.plan,\n      template_id: user.template_id,\n      is_premium: user.is_premium,\n      created_at: user.created_at.toISOString(),\n    };\n\n    return successResponse('User registered successfully', {\n      user: userResponse,\n      auth: {\n        access_token,\n        token_type: 'bearer',\n        expires_in: 3600,\n      },\n    }, 201);\n\n  } catch (error: any) {\n    console.error('Registration error:', error);\n    return errorResponse('Internal server error', 500);\n  }\n}"],"names":[],"mappings":";;;;AACA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,IAAA,6HAAS;QAEf,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,aAAa,EAAE,OAAO,MAAM,EAAE,GAAG,MAAM,QAAQ,IAAI;QAElF,aAAa;QACb,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,YAAY,CAAC,eAAe;YAClD,OAAO,IAAA,sIAAa,EAAC,2BAA2B;QAClD;QAEA,IAAI,SAAS,MAAM,GAAG,GAAG;YACvB,OAAO,IAAA,sIAAa,EAAC,0CAA0C;QACjE;QAEA,+BAA+B;QAC/B,MAAM,eAAe,MAAM,2HAAI,CAAC,OAAO,CAAC;YAAE;QAAM;QAChD,IAAI,cAAc;YAChB,OAAO,IAAA,sIAAa,EAAC,4BAA4B;QACnD;QAEA,cAAc;QACd,MAAM,OAAO,MAAM,2HAAI,CAAC,MAAM,CAAC;YAC7B;YACA;YACA;YACA;YACA;YACA,YAAY,SAAS;YACrB,aAAa,SAAS,YAAY,gBAAgB;QACpD;QAEA,iBAAiB;QACjB,MAAM,eAAe,IAAA,qIAAa,EAAC;QAEnC,MAAM,eAAe;YACnB,IAAI,KAAK,GAAG,CAAC,QAAQ;YACrB,MAAM,KAAK,IAAI;YACf,OAAO,KAAK,KAAK;YACjB,eAAe,KAAK,aAAa;YACjC,MAAM,KAAK,IAAI;YACf,aAAa,KAAK,WAAW;YAC7B,YAAY,KAAK,UAAU;YAC3B,YAAY,KAAK,UAAU,CAAC,WAAW;QACzC;QAEA,OAAO,IAAA,wIAAe,EAAC,gCAAgC;YACrD,MAAM;YACN,MAAM;gBACJ;gBACA,YAAY;gBACZ,YAAY;YACd;QACF,GAAG;IAEL,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,IAAA,sIAAa,EAAC,yBAAyB;IAChD;AACF","debugId":null}}]
}